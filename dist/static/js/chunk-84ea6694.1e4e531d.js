(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-84ea6694"],{"000f":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticStyle:{display:"inline-block"}},[a("upload-excel-component",{attrs:{"on-success":e.handleSuccess,"before-upload":e.beforeUpload}})],1),""!==e.filename?a("el-tag",{attrs:{closable:""},on:{close:function(t){return e.handleCloseUploadFileName(e.filename)}}},[e._v(" "+e._s(e.filename)+" ")]):e._e(),a("div",[a("div",[a("br"),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addTab(e.editableTabsValue)}}},[e._v(" 新增过滤方案 ")])],1),a("el-tabs",{attrs:{type:"card",closable:""},on:{"tab-remove":e.removeTab,"tab-click":e.clickTab},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,(function(t){return a("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},nativeOn:{click:function(t){return t.preventDefault(),e.addRow(e.filterTable)}}}),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.filterTable,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"字段",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-select",{attrs:{placeholder:"请选择"},model:{value:l.key,callback:function(t){e.$set(l,"key",t)},expression:"row.key"}},e._l(e.tableHeader,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"条件",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-select",{attrs:{placeholder:"请选择"},model:{value:l.condition,callback:function(t){e.$set(l,"condition",t)},expression:"row.condition"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"值",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-input",{staticClass:"edit-input",attrs:{size:"small"},model:{value:l.value,callback:function(t){e.$set(l,"value",t)},expression:"row.value"}})]}}],null,!0)}),a("el-table-column",{attrs:{label:"",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-minus",size:"mini"},nativeOn:{click:function(a){return a.preventDefault(),e.deleteRow(t.$index,e.filterTable)}}})]}}],null,!0)})],1)],1)})),1)],1),a("FilenameOption",{model:{value:e.filename,callback:function(t){e.filename=t},expression:"filename"}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},nativeOn:{click:function(t){return t.preventDefault(),e.filterData(t)}}},[e._v("过滤")]),a("el-button",{nativeOn:{click:function(t){return t.preventDefault(),e.resetData(t)}}},[e._v("重置")]),a("el-button",{staticStyle:{margin:"0 0 20px 20px"},attrs:{loading:e.downloadLoading,type:"primary",icon:"el-icon-document"},on:{click:e.handleDownload}},[e._v(" 导出 ")]),a("a",{staticStyle:{"margin-left":"15px"},attrs:{href:"https://panjiachen.github.io/vue-element-admin-site/feature/component/excel.html",target:"_blank"}},[a("el-tag",{attrs:{type:"info"}},[e._v("精准测试规范")])],1)],1),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.list,border:"",fit:"","element-loading-text":"Loading...","highlight-current-row":""}},[e.tableHeader.length>0?a("el-table-column",{attrs:{align:"center",label:"序号",width:"50",type:"index"}}):e._e(),e._l(e.tableHeader,(function(e){return a("el-table-column",{key:e,attrs:{prop:e,label:e,align:"center","show-overflow-tooltip":!0,width:"200px"}})}))],2)],1)],1)},n=[],i=(a("d3b7"),a("3ca3"),a("ddb0"),a("d81d"),a("b0c0"),a("a15b"),a("fb6a"),a("159b"),a("4de4"),a("a434"),a("caad"),a("2532"),a("ed08")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block"}},[a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[e._v("文件名: ")]),a("el-input",{staticStyle:{width:"345px"},attrs:{placeholder:"Please enter the file name (default excel-list)","prefix-icon":"el-icon-document"},model:{value:e.filename,callback:function(t){e.filename=t},expression:"filename"}})],1)},s=[],r={props:{value:{type:String,default:""}},computed:{filename:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}}},u=r,c=a("2877"),d=Object(c["a"])(u,o,s,!1,null,null,null),f=d.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{ref:"excel-upload-input",staticClass:"excel-upload-input",attrs:{type:"file",accept:".xlsx, .xls"},on:{change:e.handleClick}}),a("div",{staticClass:"drop",on:{drop:e.handleDrop,dragover:e.handleDragover,dragenter:e.handleDragover}},[e._v(" 请上传DMP导出的测试用例 "),a("el-button",{staticStyle:{"margin-left":"16px"},attrs:{loading:e.loading,size:"mini",type:"primary"},on:{click:e.handleUpload}},[e._v(" 选择 ")])],1)])},b=[],h=(a("2ca0"),a("ac1f"),a("00b4"),a("1146")),v=a.n(h),m={props:{beforeUpload:Function,onSuccess:Function},data:function(){return{loading:!1,excelData:{header:null,results:null,multiHeader:null}}},methods:{generateData:function(e){var t=e.headers,a=e.results,l=e.multiHeader;this.excelData.header=t,this.excelData.results=a,this.excelData.multiHeader=l,this.onSuccess&&this.onSuccess(this.excelData)},handleDrop:function(e){if(e.stopPropagation(),e.preventDefault(),!this.loading){var t=e.dataTransfer.files;if(1===t.length){var a=t[0];if(!this.isExcel(a))return this.$message.error("Only supports upload .xlsx, .xls, .csv suffix files"),!1;this.upload(a),e.stopPropagation(),e.preventDefault()}else this.$message.error("Only support uploading one file!")}},handleDragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleUpload:function(){this.$refs["excel-upload-input"].click()},handleClick:function(e){var t=e.target.files,a=t[0];a&&this.upload(a)},upload:function(e){if(this.$refs["excel-upload-input"].value=null,this.beforeUpload){var t=this.beforeUpload(e);t&&this.readerData(e)}else this.readerData(e)},readerData:function(e){var t=this;return this.loading=!0,new Promise((function(a,l){var n=new FileReader;n.onload=function(e){var l=e.target.result,n=v.a.read(l,{type:"array"}),i=n.SheetNames[0],o=n.Sheets[i],s=t.getHeaderRow(o),r=s.multiHeader,u=s.headers,c=t.getTabledata(o,r,u);t.generateData({headers:u,results:c,multiHeader:r}),t.loading=!1,a()},n.readAsArrayBuffer(e)}))},getTabledata:function(e,t,a){var l=v.a.utils.sheet_to_json(e),n=[];if(t.length>0&&t[0][0].startsWith("用例管理")){var i="__EMPTY";void 0===l[3]["__EMPTY"]&&(i="");for(var o=3;o<l.length;o++){for(var s=l[o],r={},u=0;u<a.length;u++){var c=a[u];if(0===u)r[c]=s[t[0][0]];else if(1===u)r[c]=s[i];else{var d=u-1;r[c]=s[i+"_"+d]}}n.push(r)}return n}return l},getHeaderRow:function(e){var t,a,l=[],n=[],i=v.a.utils.decode_range(e["!ref"]),o=i.s.r,s=v.a.utils.format_cell(e[v.a.utils.encode_cell({c:0,r:0})]);if(s.startsWith("用例管理"))for(a=i.s.r;a<=i.e.r;++a){if(a>3)break;var r=[];for(t=i.s.c;t<=i.e.c;++t){var u=e[v.a.utils.encode_cell({c:t,r:a})],c="";u&&u.t&&(c=v.a.utils.format_cell(u)),a<=2?r.push(c):l.push(c)}a<=2&&n.push(r)}else for(t=i.s.c;t<=i.e.c;++t){var d=e[v.a.utils.encode_cell({c:t,r:o})],f="Null";d&&d.t&&(f=v.a.utils.format_cell(d)),l.push(f)}return{multiHeader:n,headers:l}},isExcel:function(e){return/\.(xlsx|xls|csv)$/.test(e.name)}}},g=m,y=(a("75e8d"),Object(c["a"])(g,p,b,!1,null,"288eb692",null)),x=y.exports,k={name:"ExportExcel",components:{FilenameOption:f,UploadExcelComponent:x},data:function(){return{list:null,readonlylist:null,listLoading:!0,isUploadedFile:!1,downloadLoading:!1,filename:"",autoWidth:!0,bookType:"xlsx",tableHeader:[],editableTabsValue:"2",tabsData:{},editableTabs:[],tabIndex:2,filterTable:[{key:void 0,condition:"in",value:void 0}],options:[{label:"包含",value:"in"},{label:"不包含",value:"notin"},{label:"等于",value:"eq"},{label:"不等于",value:"noteq"},{label:"大于等于",value:"gt"},{label:"小于等于",value:"lt"}]}},created:function(){this.fetchData(),this.initTabs()},methods:{initTabs:function(){for(var e in this.tabsData={tab1:{title:"方案 1",name:"tab1",content:[{key:"用例级别",condition:"in",value:"P1"},{key:"工作量（正整数，单位：分钟）",condition:"gt",value:"15"}]},tab2:{title:"方案 2",name:"tab2",content:[{key:"",condition:"in",value:""}]}},this.tabsData)this.editableTabs.push(this.tabsData[e]);this.selectTab("tab1")},fetchData:function(){this.listLoading=!0,this.listLoading=!1},handleDownload:function(){var e=this;null!==this.readonlylist?(this.downloadLoading=!0,Promise.all([a.e("chunk-7f4cd4ea"),a.e("chunk-2d0cc0b6")]).then(a.bind(null,"4bf8")).then((function(t){var a=e.tableMultiHeader,l=e.tableHeader,n=e.tableHeader,i=e.list,o=e.formatJson(n,i),s=[];t.export_json_to_excel({multiHeader:a,header:l,merges:s,data:o,filename:e.filename,autoWidth:e.autoWidth,bookType:e.bookType}),e.downloadLoading=!1}))):this.$message({message:"请先上传文件",type:"warning"})},formatJson:function(e,t){return t.map((function(t){return e.map((function(e){return"timestamp"===e?Object(i["d"])(t[e]):t[e]}))}))},beforeUpload:function(e){var t=e.size/1024/1024<3;if(t){var a=e.name.split("."),l=a.slice(0,-1).join(".");return this.filename="精准测试用例-"+l,!0}return this.$message({message:"Please do not upload files larger than 1m in size.",type:"warning"}),!1},handleSuccess:function(e){var t=e.results,a=e.header,l=e.multiHeader;console.log("handleSuccess results",t),console.log("handleSuccess header",a),console.log("handleSuccess multiHeader",l),this.list=t,this.readonlylist=t,this.tableHeader=a,this.listLoading=!0,this.tableMultiHeader=l,this.listLoading=!1,this.isUploadedFile=!0},handleCloseUploadFileName:function(){this.isUploadedFile=!1,this.list=null,this.tableHeader=[],this.filename=""},addTab:function(e){var t=++this.tabIndex+"",a={title:"方案"+this.tabIndex,name:t,content:[{key:void 0,condition:"in",value:void 0}]};this.editableTabs.push(a),this.tabsData[t]=a,this.editableTabsValue=t,this.filterTable=a.content},removeTab:function(e){console.log("removeTab",e);var t=this.editableTabs,a=this.editableTabsValue;a===e&&t.forEach((function(l,n){if(l.name===e){var i=t[n+1]||t[n-1];i&&(a=i.name)}})),this.editableTabsValue=a,this.editableTabs=t.filter((function(t){return t.name!==e}))},clickTab:function(e){var t=e.name;this.selectTab(t)},selectTab:function(e){this.editableTabsValue=e,this.filterTable=this.tabsData[e].content},deleteRow:function(e,t){t.splice(e,1)},addRow:function(e){e.push({key:void 0,condition:"in",value:void 0})},filterData:function(){var e=this.filterTable,t=this.readonlylist;if(null!==t){var a=t.filter((function(t){return e.every((function(e){var a=e.key,l=e.condition,n=e.value;return"in"===l?t[a].includes(n):"notin"===l?!t[a].includes(n):"eq"===l?t[a]===n:"noteq"===l?t[a]!==n:"gt"===l?parseInt(t[a])>=parseInt(n):"lt"===l?parseInt(t[a])<=parseInt(n):void 0}))}));this.list=a,console.log(a)}else this.$message({message:"请先上传文件",type:"warning"})},resetData:function(){this.list=this.readonlylist}}},T=k,_=(a("292d"),Object(c["a"])(T,l,n,!1,null,null,null));t["default"]=_.exports},1:function(e,t){},2:function(e,t){},"292d":function(e,t,a){"use strict";a("53fb")},3:function(e,t){},"53fb":function(e,t,a){},"75e8d":function(e,t,a){"use strict";a("83d62")},"83d62":function(e,t,a){}}]);